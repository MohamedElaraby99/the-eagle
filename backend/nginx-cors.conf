# Nginx CORS Configuration for The Eagle API
# Place this in your nginx server block or include it

# Handle CORS preflight requests
if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' $http_origin always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, x-auth-token, Origin, Accept, X-Requested-With' always;
    add_header 'Access-Control-Allow-Credentials' 'true' always;
    add_header 'Access-Control-Max-Age' '86400' always;
    add_header 'Content-Type' 'text/plain; charset=utf-8' always;
    add_header 'Content-Length' '0' always;
    return 204;
}

# Add CORS headers to all responses
add_header 'Access-Control-Allow-Origin' $http_origin always;
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, x-auth-token, Origin, Accept, X-Requested-With' always;
add_header 'Access-Control-Allow-Credentials' 'true' always;
add_header 'Access-Control-Expose-Headers' 'Content-Length, X-Foo, X-Bar' always;

# Handle specific domains
map $http_origin $cors_origin {
    default "";
    "https://www.the-eagle.fikra.solutions" "https://www.the-eagle.fikra.solutions";
    "https://the-eagle.fikra.solutions" "https://the-eagle.fikra.solutions";
    "https://api.the-eagle.fikra.solutions" "https://api.the-eagle.fikra.solutions";
    "~^https://.*\.the-eagle\.fikra\.solutions$" $http_origin;
}

# Use the mapped origin
add_header 'Access-Control-Allow-Origin' $cors_origin always;
